# CLAUDE.md - VuVenu v2

## Projet

**VuVenu** est un SaaS B2B de g√©n√©ration de contenu marketing pour commerces locaux.

- **Cible** : Commer√ßants locaux fran√ßais (restaurants, salons, boutiques...)
- **Produit** : Scripts vid√©o + Campagnes Meta Ads g√©n√©r√©s par IA
- **Stack** : Next.js 14 + Supabase + Stripe + Claude + Gemini

---

## WORKFLOW OBLIGATOIRE : Plan ‚Üí Validation ‚Üí Ralph

**R√àGLE ABSOLUE** : Pour TOUTE demande de modification (feature, fix, changement UI, etc.), suivre ce workflow en 2 √©tapes :

### √âtape 1 : PLAN (automatique)

D√®s qu'une modification est demand√©e :

1. **Analyser** la demande (screenshot, description, ou les deux)
2. **Explorer** le codebase pour identifier les fichiers concern√©s
3. **Cr√©er un PRD** dans `tasks/prd-{feature}.json` avec :
   - Titre et description
   - User Stories atomiques (1 story = 1 changement)
   - Fichiers √† modifier
   - Crit√®res d'acceptation
4. **Pr√©senter le plan** √† l'utilisateur pour validation

Format de pr√©sentation :
```
üìã PLAN : {titre}

üìù Description : {description}

üìå User Stories :
- US-001: {titre} ‚Üí {fichiers}
- US-002: {titre} ‚Üí {fichiers}

üéØ Crit√®res d'acceptation :
- {crit√®re 1}
- {crit√®re 2}

Valide ce plan ? (oui/non/modifier)
```

### √âtape 2 : RALPH (apr√®s validation)

Une fois le plan valid√© par l'utilisateur :

1. Ex√©cuter `/ralph {feature-name}`
2. Ralph impl√©mente chaque story automatiquement
3. Valide (typecheck + lint) apr√®s chaque story
4. Commit apr√®s chaque story
5. Push + cr√©e PR √† la fin
6. Retourne le lien de la PR

### Exemples

**Exemple 1 : Screenshot + description**
```
Utilisateur: [screenshot] "Change ce bouton en vert"
Claude:
üìã PLAN : bouton-vert-hero
üìù Description : Modifier la couleur du bouton CTA hero en vert lime
üìå User Stories :
- US-001: Modifier classe CSS du bouton ‚Üí src/app/page.tsx
üéØ Crit√®res : Bouton affiche bg-vuvenu-lime
Valide ce plan ?

Utilisateur: oui
Claude: /ralph bouton-vert-hero
[... ex√©cution ...]
‚úÖ PR: https://github.com/.../pull/N
```

**Exemple 2 : Nouvelle feature**
```
Utilisateur: "Ajoute un dark mode"
Claude:
üìã PLAN : dark-mode
üìù Description : Impl√©menter le dark mode sur l'application
üìå User Stories :
- US-001: Ajouter CSS variables dark ‚Üí globals.css
- US-002: Cr√©er toggle component ‚Üí components/ui/theme-toggle.tsx
- US-003: Persister pr√©f√©rence ‚Üí localStorage
üéØ Crit√®res : Toggle fonctionne, pr√©f√©rence persist√©e
Valide ce plan ?

Utilisateur: oui
Claude: /ralph dark-mode
```

### Ce workflow s'applique √† :
- Nouvelles features
- Modifications UI (avec ou sans screenshot)
- Bug fixes
- Refactoring
- Ajout de composants
- Modifications de style

### Exceptions (pas besoin de Ralph) :
- Questions sur le code (lecture seule)
- Recherche dans le codebase
- Explication de fonctionnement
- Conseils d'architecture (sans impl√©mentation)

---

## Documents de R√©f√©rence (dans ce projet)

Tous les documents sont maintenant dans `reference/` :

```
reference/
‚îú‚îÄ‚îÄ foundations/           # Documents fondateurs
‚îÇ   ‚îú‚îÄ‚îÄ 01-BUSINESS-PLAN.md
‚îÇ   ‚îú‚îÄ‚îÄ 02-PRODUCT-SPECIFICATION.md
‚îÇ   ‚îú‚îÄ‚îÄ 03-BRAND-IDENTITY.md
‚îÇ   ‚îú‚îÄ‚îÄ 04-TECHNICAL-ARCHITECTURE.md
‚îÇ   ‚îú‚îÄ‚îÄ 05-CONTENT-ENGINE.md
‚îÇ   ‚îî‚îÄ‚îÄ 06-OPERATIONAL-GUIDE.md
‚îú‚îÄ‚îÄ skills/                # Prompts IA
‚îÇ   ‚îú‚îÄ‚îÄ vu-venu-scripts.zip
‚îÇ   ‚îî‚îÄ‚îÄ vu-venu-meta-ads.zip
‚îî‚îÄ‚îÄ viral-reports/         # 22 rapports par industrie
    ‚îú‚îÄ‚îÄ Activit√©s & Loisirs/
    ‚îú‚îÄ‚îÄ Animaux/
    ‚îú‚îÄ‚îÄ ... (22 dossiers)
    ‚îî‚îÄ‚îÄ Wellness & Relaxation/
```

**Autres fichiers cl√©s** :
- `supabase/migrations/001_initial_schema.sql` - Schema PostgreSQL complet
- `src/lib/data/industries-full.json` - 22 industries, 152 niches

---

## Plan d'Impl√©mentation

Voir `RALPH-LOOP-PLAN.md` pour le plan complet en 6 phases.

---

## Design System

### Couleurs
```css
--vuvenu-lime: #BFFF00;      /* CTA principal */
--vuvenu-blue: #60A5FA;      /* √âl√©ments graphiques */
--vuvenu-violet: #C4B5FD;    /* Sections secondaires */
--vuvenu-cream: #FFFBEB;     /* Background */
--vuvenu-dark: #0F172A;      /* Sidebar, texte */
```

### Typographie
- **Titres** : Satoshi (font-display)
- **Corps** : Inter (font-sans)
- **Accents** : Playfair Display (font-accent)

### Composants
- Utiliser shadcn/ui exclusivement
- Boutons primaires : bg-vuvenu-lime text-vuvenu-dark
- Cards : bg-white rounded-2xl shadow-lg
- Sidebar : bg-vuvenu-dark text-white

---

## Conventions Code

### Structure Fichiers
```
src/
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/            # Routes non connect√©es
‚îÇ   ‚îú‚îÄ‚îÄ (dashboard)/       # Routes connect√©es
‚îÇ   ‚îú‚îÄ‚îÄ (marketing)/       # Pages publiques
‚îÇ   ‚îî‚îÄ‚îÄ api/               # Routes API
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                # shadcn/ui
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ campaigns/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îú‚îÄ‚îÄ stripe/
‚îÇ   ‚îú‚îÄ‚îÄ ai/
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ hooks/
‚îî‚îÄ‚îÄ types/
```

### TypeScript
- Mode strict activ√©
- Toujours typer les param√®tres et retours
- Utiliser les types g√©n√©r√©s Supabase

### Imports
```typescript
// 1. React/Next
import { useState } from 'react'
import { useRouter } from 'next/navigation'

// 2. Libs externes
import { z } from 'zod'

// 3. Composants internes
import { Button } from '@/components/ui/button'

// 4. Lib interne
import { createClient } from '@/lib/supabase/client'

// 5. Types
import type { Script } from '@/types/database'
```

---

## R√®gles Strictes

### FAIRE
- Mobile-first toujours
- Validation Zod sur tous les inputs API
- RLS Supabase sur toutes les tables
- Streaming pour les r√©ponses IA
- Toast notifications pour feedback
- Loading states explicites
- Error boundaries

### NE PAS FAIRE
- CSS modules (Tailwind uniquement)
- console.log en production
- Secrets en dur
- Fichiers > 300 lignes
- Over-engineering
- D√©pendances inutiles
- Composants client sans n√©cessit√©

---

## Commands

```bash
# D√©veloppement
npm run dev

# Build
npm run build

# Lint
npm run lint

# Type check
npm run typecheck

# G√©n√©rer types Supabase
npx supabase gen types typescript --project-id <id> > src/types/database.ts
```

---

## Variables d'Environnement

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# Stripe
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PRICE_STARTER_MONTHLY=
STRIPE_PRICE_STARTER_YEARLY=
STRIPE_PRICE_PRO_MONTHLY=
STRIPE_PRICE_PRO_YEARLY=
STRIPE_PRICE_BUSINESS_MONTHLY=
STRIPE_PRICE_BUSINESS_YEARLY=

# AI
ANTHROPIC_API_KEY=
GOOGLE_AI_API_KEY=

# App
NEXT_PUBLIC_APP_URL=
```

---

## Patterns R√©currents

### Formulaire avec validation
```typescript
const formSchema = z.object({
  name: z.string().min(2),
  email: z.string().email(),
})

export function MyForm() {
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
  })
  // ...
}
```

### Route API prot√©g√©e
```typescript
export async function POST(request: NextRequest) {
  const supabase = await createClient()

  const { data: { user }, error } = await supabase.auth.getUser()
  if (!user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  // Valider input avec Zod
  // V√©rifier limites
  // Ex√©cuter logique
  // Retourner r√©sultat
}
```

### Streaming IA
```typescript
const stream = await anthropic.messages.stream({
  model: 'claude-sonnet-4-20250514',
  messages: [...],
})

return new Response(stream.toReadableStream())
```

---

## S√©curit√©

- Jamais de secrets c√¥t√© client
- Toujours valider les inputs serveur
- RLS sur toutes les tables utilisateur
- V√©rifier signature webhooks Stripe
- Limiter les appels API IA par user

---

*VuVenu v2 - Janvier 2026*

---

## üéØ Skill Principal : /ralph

**Un seul skill pour tout** : `/ralph {feature-name}`

Ex√©cute un PRD valid√© de mani√®re autonome :
1. **Lit AGENTS.md** - Charge les patterns et conventions
2. Cr√©e la branche
3. Impl√©mente chaque User Story
4. Valide (typecheck + lint)
5. Commit apr√®s chaque story
6. **Met √† jour AGENTS.md** - Si nouveaux patterns d√©couverts
7. Push + cr√©e PR

Voir `.claude/commands/ralph.md` pour la documentation compl√®te.

## üìö AGENTS.md - M√©moire Persistante

**Compound Engineering** : Chaque unit√© de travail rend les suivantes plus faciles.

`AGENTS.md` √† la racine du projet contient :
- Patterns de code r√©utilisables (ex: `btn-sparkle` pour boutons)
- Gotchas rencontr√©s et solutions
- Conventions √©tablies
- Learnings des it√©rations pr√©c√©dentes

**Mis √† jour automatiquement** par Ralph quand un nouveau pattern pertinent est d√©couvert.

## üì∏ Mapping zones ‚Üí fichiers

| Zone | Fichier |
|------|---------|
| Landing Page | `src/app/page.tsx` |
| Sidebar | `src/components/dashboard/sidebar.tsx` |
| Header | `src/components/dashboard/header.tsx` |
| Dashboard KPIs | `src/components/dashboard/kpi-cards.tsx` |
| Scripts List | `src/app/(dashboard)/scripts/page.tsx` |
| Campaigns | `src/app/(dashboard)/campaigns/page.tsx` |
| Settings | `src/app/(dashboard)/settings/page.tsx` |
| UI Components | `src/components/ui/*.tsx` |
| CSS Global | `src/app/globals.css` |

## üìã Checklist Feature VuVenu

Avant de consid√©rer une feature compl√®te :

- [ ] Code TypeScript strict (pas de `any` non justifi√©)
- [ ] Sch√©ma BDD align√© avec code (migrations cr√©√©es)
- [ ] RLS policies en place sur tables user-facing
- [ ] Validation Zod sur tous les inputs API
- [ ] Tests E2E couvrent flow principal
- [ ] Gestion d'erreurs compl√®te (try/catch, logs)
- [ ] Loading states + error states UI
- [ ] Mobile-responsive (test sur iPhone/Android)
- [ ] Performance OK (LCP < 2.5s)
- [ ] Commit conventionnel + push

## üêõ Debug Patterns VuVenu

### Erreur Supabase "Failed to save"
```typescript
// ‚ùå Mauvais : pas de gestion d'erreur
const { data } = await supabase.from('table').insert(...)

// ‚úÖ Bon : log d√©taill√©
const { data, error } = await supabase.from('table').insert(...)
if (error) {
  console.error('Insert error:', error)
  throw new Error(`Failed to save: ${error.message}`)
}
```

### Cl√© API invalide
```bash
# V√©rifier ~/.zshrc n'√©crase pas .env.local
grep "ANTHROPIC_API_KEY" ~/.zshrc
# Si trouv√©, commenter la ligne

# Red√©marrer serveur dans nouveau shell
pkill -9 -f "next dev"
npm run dev
```

### Migration Supabase non appliqu√©e
```bash
# Appliquer manuellement via Dashboard SQL Editor
# Ou via CLI:
psql < supabase/migrations/XXX_migration.sql
```

---

*VuVenu v2 - SaaS B2B Marketing pour Commerces Locaux*
*Stack: Next.js 16 + Supabase + Stripe + Claude + Gemini*

